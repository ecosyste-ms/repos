<% @meta_title = "#{@repository.full_name} dependencies | #{@host}" %>
<% @meta_description = @repository.description %>

<div class="container-sm">
  <%= render 'overview' %>

  <div class="row">
    <div class="col-lg-8">
      <%= render 'tabs' %>

      <% if @repository.dependencies_parsed_at %>
        <% if @manifests.present? %>
          <% @manifests.each do |manifest| %>
            <div class="card mt-3">
              <div class="card-header">
                <%= link_to manifest.filepath, manifest.repository_link, target: :_blank %>
                <span class='text-muted'>
                  <%= manifest.ecosystem %>
                </span>
              </div>
              <ul class="list-group list-group-flush">
                <% if manifest.lockfile? && manifest.dependencies.length > 100 %>
                  <li class="list-group-item">
                    <%= link_to pluralize(manifest.dependencies.length, 'dependencies'), manifest.repository_link, target: :_blank %>
                  </li>
                <% else %>
                  <% manifest.dependencies.sort_by{|d| [d.kind.to_s, d.package_name]}.each do |dependency| %>
                    <li class="list-group-item">
                      <%= link_to dependency.package_name, usage_path(dependency.ecosystem, dependency.package_name) %>
                      <i><%= dependency.requirements %></i>
                      <small class='text-muted'>
                      <% if dependency.kind != 'runtime' %>
                        <%= dependency.kind %>
                      <% end %>
                      <% if dependency.optional %>
                        (optional)
                      <% end %>
                      </small>
                    </li>
                  <% end %>
                <% end %>
              </ul>
            </div>
          <% end %>
        <% else %>
          <p class='mt-3'>No dependencies found</p>
        <% end %>
      <% end %>
    </div>
    <div class="col-lg-4">
      <%= render 'sidebar' %>
    </div>
  </div>
</div>
